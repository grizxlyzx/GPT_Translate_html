# GPT Translate HTML
***
This project harnesses the power of LLM and a novel method to enhance translation quality for HTML files.
## Description
***
Typically, translating an HTML file involves extracting text from each tag and translating it independently.
However, this approach often yields unreadable translation due to the lack of context for each piece of text.
This problem becomes severer with HTML-based documentation generated by tools like Sphinx, which tend to feature complex 
nested structures and scattered text fragments.
For instance, a single line of function declaration may comprise multiple nested tags, representing the return type, 
the function name, left parenthesis, arguments and right parenthesis respectively. 
The traditional translation method would translate each individual tag separately, even with GPT, which is not desired.

To address this lack-of-context problem and achieve higher translation quality, 
I devised and implement this two-step approach:

1. Group adjacent *inline* tags to form semantically complete text fragments, and ask LLM to translate each fragments.
2. Ask LLM again to split each translation and fit back into the tags to recover the DOM structure.

This approach capitalizes on the reductive bias observed in HTML, where adjacent inline elements often(though not mandatory)
combine to form coherent sentences or paragraphs.

## Getting Started
***
### Dependencies
With Python >= 3.9 conda/virtual/system environment:
```
cd /path/to/project/directory
pip install -r ./requirements.txt
```
If you use GPT as your translator LLM, make sure environment variable```OPENAI_API_KEY``` is set:
```
export OPENAI_API_KEY='your-api-key'
```
or set your api base and api key in ```./config/openai_api_conf.py```
***
### Use other LLMs
Translation pipeline invokes LLM via OpenaiAPI-style RESTful api, so it is possible to use any LLM as long an OpenaiAPI-style 
service is deployed.

To configure the API base, API key for other LLM service, edit corresponding fields in ```./config/openai_api_conf.py```
***
### Translate single HTML file
The entrance of single HTML translation function is ```translation_pipeline(soup: BeautifulSoup)``` in ```translate.py```.
This function is implemented asynchronously in order to optimize the performance of batch translation.

You can choose LLMs and tweak other translation parameters like languages in ```./config/translate_config.py```

Run 
```
cd /path/to/project/directory
python ./translate.py
```
to translate ```./example/installation.html``` page into Simplified Chinese as an example.

#### Example usage
```Python
import asyncio
from bs4 import BeautifulSoup
from translate import translation_pipeline

p_in = './example/installation.html'
p_out = './example/out.html'
with open(p_in, 'r') as fin:
    html_in = fin.read()
bs = BeautifulSoup(html_in, 'html.parser')
ret = asyncio.run(translation_pipeline(bs))
with open(p_out, 'w') as fout:
    fout.write(str(bs))
print('Result:', ret)
```
***
### Batch Translation
```batch_example.py``` provide an example usage for the scenario in which you have a tree of directories containing many HTML files 
to be translated, e.g. a documentation. 

Before running this example, open ```batch_exmaple.py```, set root of input directory```ori_docs_root``` and 
root of output directory```translated_root``` under ```__main__```

Then, 
```
python ./batch_example.py
```
